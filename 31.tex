\section{
 Лемма Гензеля. Разложение на множители при помощи леммы Гензеля.
}

% \textbf{Необработанная версия из конспекта Константина Михайловича}
{\it Шпаргалка.}\\
    % Лемма Гензеля: Есть разложение $f \equiv_p gh,~(g, h) = 1 \Rightarrow$ можем найти $f \equiv_{p^k} \hat{g}\hat{h}$, где $\deg h= \deg \hat{h}$, $\deg g= \deg \hat{g}$, $\hat{g}\equiv_p g$, а $\hat{h}\equiv_p h$.\\
    Доказательство леммы: Индукция по k. Строим для k + 1. Помним, что $\forall f:~p^{k}f \equiv p^{k}\ovl{f} \pmod{p^{k + 1}}$.\\
    $\ovl{h} \equiv \hat{h}+p^ka(x) \Rightarrow \ovl{h}\ovl{g} \equiv \hat{g}\hat{h} + p^{k}(a(x)g + b(x)h)$. С другой стороны $f-\hat{g}\hat{h}=p^kc(x) \Rightarrow$ $a,~b$ берем из лп НОДа $g$ и $h$\\


Теперь вернёмся к многочленам от одной переменной. Для проверки неприводимости мы с успехом использовали информацию, полученную из разложения по модулю $n$. Вопрос -- нельзя ли её же использовать и в целочисленной задаче?

Во-первых, если взять достаточно большой модуль $n$, заметно больший, чем коэффициенты в целочисленном разложении, то разложение $f$ по модулю $n$ с маленькими коэффициентами однозначно будет определять кандидата на целочисленное разложение. Это соображение встречается сразу с двумя проблемами -- первая -- не ясно какие есть ограничения на коэффициенты сомножителей, вторая -- разложений по модулю $n$ может быть много и нет способа эффективно искать их.



Как же теперь выбрать достаточно большое число, по модулю которого раскладывать многочлен $f$ на множители? В первую очередь, должно быть удобно раскладывать многочлен по подходящему множителю. Наибольшим удобством в решении задачи разложения обладают поля. В этом смысле возможно стоило бы искать разложение $f$ по модулю очень большого простого. Однако найти большое простое число довольно тяжело. Смотреть по модулю маленьких простых а потом пытаться склеивать разложение в духе китайской теоремы об остатках может банально не получиться (как в примере 3 из билета 29 -- неясно во что склеить два разных разложения). Оказывается наиболее оптимальный вариант такой -- взять небольшое простое число $p$, разложить $f$ над $\mb Z/p$ а затем <<поднять>> это разложение по модулю $p^k$ для достаточно большого $k$. Сформулируем утверждение, которое пояснит как это сделать.

\rm Пусть $f \in \mb Z[x], \ovl{f} \in \mb Z/p[x] \Rightarrow p^{k}f \equiv p^{k}\ovl{f} \pmod{p^{k + 1}}$
\proof Посмотрим на $a_i \in f$.
$$ p^k a_i \equiv p^k (pq_i + r_i) \equiv p^{k+1} q_i + p^k r_i \equiv p^k r_i \equiv p^k\ovl{a_i} \pmod{p^{k + 1}}$$
\endproof
\erm

\lm[Гензеля] Пусть $f \in \mb Z[x]$, со старшим коэффициентом не делящимся на простое число $p$. Пусть $\ovl{f}=gh$ в кольце $\mb Z/p[x]$, причём $(g,h)=1$. Тогда  для любого $k\geq 1$ существуют единственные по модулю $p^k$ многочлены $\hat{g}, \hat{h} \in \mb Z[x]$, что $\ovl{f}=\hat{g} \hat{h} \mod p^k$  и $\deg h= \deg \hat{h}$, $\deg g= \deg \hat{g}$, $\hat{g}\equiv g \pmod{p}$, а $\hat{h}\equiv h \pmod{p}$.
\proof Докажем это индукцией по $k$. Пусть по модулю $p^{k}$ уже построены подходящие многочлены $\hat{h}$ и $\hat{g}$ и мы хотим построить $\ovl{h}$ и $\ovl{g}$. Заметим, что благодаря единственности по модулю $p^k$, такие $\ovl{g}$ и $\ovl{h}$ обязаны совпадать с $\hat{h}$ и $\hat{g}$ по модулю $p^k$. Это означает, что по модулю $p^{k+1}$

$$\ovl{h} \equiv \hat{h}+p^ka(x)\pmod{p^{k+1}} \text{\,\, и\quad } \ovl{g} \equiv \hat{g} + p^kb(x)\pmod{p^{k+1}}.$$

Заметим, что многочлены $a(x)$ и $b(x)$  однозначно определяются по модулю $p$ (по прошлому замечанию), если известны $\ovl{g}$ и $\ovl{h}$ и по модулю $p$ могут иметь степени меньше чем степени $h(x)$ и $g(x)$ соответственно. Покажем, что такие $a(x), b(x)$ существуют и единственны по модулю $p$. Заметим, что необходимо проверить лишь условие $f \equiv \ovl{g}\ovl{h} \pmod{p^{k+1}}$. Распишем

$$f\equiv \hat{g}\hat{h} + a(x)p^{k}\hat{g} + b(x)p^{k}\hat{h} + p^{2k}a(x)b(x) \equiv \hat{g}\hat{h} + p^{k}(a(x)g + b(x)h) \pmod{p^{k+1}}.$$

Здесь мы заменили $\hat{h}$ и $\hat{g}$ по модулю $p$ (опять по прошлому замечанию) и получили исходные многочлены $g$ и $h$ из $\mb Z/p[x]$. Заметим, что есть единственный такой многочлен $c(x)\in\mb Z/p[x]$, что $f-\hat{g}\hat{h}=p^kc(x) \pmod{p^{k+1}}$. Теперь для выполнения сравнения выше необходимо, чтобы  $$c(x)=a(x)g(x)+b(x)h(x)$$
У такого сравнения есть единственное решение в $\mb Z/p[x]$ (лп НОДа) при условиях $(g,h)=1$ и $\deg a(x)<\deg h(x)$ и $\deg b(x)< \deg g(x)$. Что и требовалось.
\endproof
\elm


Частным случаем разложения на множители служит разложение вида $f(x)=(x-x_1)g(x)$, соответствующее наличию корня. Сформулируем следствие леммы Гензеля в этой ситуации:


\crl Пусть $f \in \mb Z[x]$, со старшим коэффициентом не делящимся на простое число $p$. Пусть $a$ корень $f$ по модулю $p$, причём $\ovl{f}'(a)\neq 0$. Тогда  для любого $k\geq 1$ существует единственный $ \hat{a}\in \mb Z/p^k$,  что $f(\hat{a})=0$ и $\hat{a} \equiv a \mod p$.
\proof
    $a$ корень $f$ по модулю $p$ $\Rightarrow$ $\ovl{f} \equiv (x - a)h(x) \pmod{p}$.\\
    $\ovl{f}'(a)\neq 0 \Rightarrow a$ не кратный корень $\Rightarrow ((x - a), h(x)) = 1$, значит можем применить лемму Гензеля.
\endproof
\ecrl

\rm Можно усилить лемму Гензеля, рассматривая подъём разложения не с модуля $p$, а с модуля $p^k$ заработав ослабление условия на производную.
\erm


Теперь алгоритм разложения на множители уже вырисовывается (описан перед леммой).
Но в лемме Гензеля есть некоторые ограничения на разложение многочлена $\ovl{f}$. Как с этим жить мы узнаем дальше.\\

{\bfСпойлер}:\\
Дискриминант даёт ответ на вопрос, когда многочлен не имеет кратных корней по модулю $p$. Действительно это происходит только тогда, когда $D(f)\ndi p$. Заметим, что это условие может нарушаться только в конечном числе $p$, если $D(f)\neq 0$. Таким образом либо у многочлена есть кратный корень, либо у него нет кратных корней для почти всех $p$. Это обосновывает, что для применения леммы Гензеля для подъёма всегда можно выбрать подходящее простое, если многочлен $f$ был бесквадратный.

